@model PagedList.IPagedList<WebView.WebService._base.PlanUnit>
@{
    ViewBag.Title = "PlanUnit_List";
}
<script type="text/javascript">

    function GetDetailsCallBack(data) {
        document.getElementById("divDetails").style.display = "block";

        SetElement("txtPU_ID1", data.Puid);
//        alert("txtPU_ID1" + data.Puid);
        SetElement("txtPU_DESC", data.Pudesc);
        SetElement("txtPU_INST_PR", data.PUInstPR);
        SetElement("txtPU_MAT_PR", data.PUMatPR);
        
        SetElement("txtDURATION", data.PUDuration);
        SetElement("txtNETWORK_FLAG", data.PUNetworkFlag);
      
       SetElement("txtACT_CODE", data.PUActCode);
       SetElement("txtSUP_DURATION", data.PUSupDuration);
       
       SetElement("txtPUBillRate", data.PUBillRate);
     
//        SetText("txtPU_ID", data.PU_ID);

       SetElement("txtPU_UOM", data.PUUom);
//       alert(data.PUUom);
//                alert(data.ListUOM);
        document.getElementById("targetPlanUnit").value = data.PU_ID;
        document.getElementById("btnClose").disabled = false;
        document.getElementById("txtPU_ID1").disabled = false ;
                
    }

    function SaveUpdateCallBack(data) {
        if (data.Success == true) {
            alert("Successfully Updated.");
            document.getElementById("divDetails").style.display = "none";
            window.location.reload();
        }
    }


    jQuery(document).ready(function ($) {

        $("#rounded-corner tbody tr").bind("click", function () {
            var t = $(this).find("#gid").text();
            var s = $(this).find("#gcode").text();

            $("#divDetails").dialog("open");

            $.ajax({
                url: '@Url.Action("GetDetails_PlanUnit", "PlanUnit")',
                type: "POST",
                dataType: "html",
                data: {
                    "id": t,
                    "code": s,
                    "random": Math.random()
                },
                beforeSend: function () { },
                success: function (data) {
                    var res = jQuery.parseJSON(data);

                    GetDetailsCallBack(res);
                    //                    System.Diagnostics.Debug.WriteLine("i UOMT :" + res.ListUOM);  

                    ListUOM2 = res.ListUOM.split(":");
                    
                    var datasListUOM = "<option selected value='" + res.PUUom + "'>" + res.PUUom + "</option>";

                    for (i = 0; i < ListUOM2.length; i++) {
                        if (ListUOM2[i] != "") {

                            datasListUOM += "<option value='" + ListUOM2[i] + "'>" + ListUOM2[i] + "</option>";
                        }
                    }
                    $("#txtPU_UOM").html(datasListUOM);
                    //$.msgBox("Please la."); 
                }
            });
        });

        var close = function () {
            $(this).dialog("close");
        }

        $("#divDetails").dialog({
            autoOpen: false,
            height: 330,
            width: 700,
            modal: true,
            buttons: {
            },
            close: function () {
                //allFields.val("").removeClass("ui-state-error");
            }
        });

        $(function () {
            $('#btnSearch').click(function () {
                var billRate = document.getElementById("billRate").value;
                var searchUOM = document.getElementById("searchUOM").value;
                window.location = "PlanUnit_List?searchKey=" + document.getElementById("searchKey").value + "&billRate=" + billRate + "&searchUOM=" + searchUOM; //Where List is the function in the controller.
            });

            //            $('#searchKey').change(function () {
            //                window.location = "PlanUnit_List?searchKey=" + document.getElementById("searchKey").value + "&billRate=" + billRate; //Where List is the function in the controller.
            //            });

            $('#btnClose').click(function () {
                $("#divDetails").dialog("close");
                var billRate = document.getElementById("billRate").value;
                window.location = "PlanUnit_List?searchKey=" + document.getElementById("searchKey").value + "&billRate=" + billRate + "&searchUOM=" + document.getElementById("searchUOM").value;
            });

            $('#searchKey').bind('keypress', function (e) {
                if (e.keyCode == 13) {
                    var billRate = document.getElementById("billRate").value;
                    var searchUOM = document.getElementById("searchUOM").value;
                    document.getElementById("searchUOM").value = UOM;
                    //                     alert(UOM);
                    window.location = "PlanUnit_List?searchKey=" + document.getElementById("searchKey").value + "&billRate=" + billRate + "&searchUOM=" + searchUOM;
                }
            });

            $('#btnNewJob').click(function () {
                window.location = "PlanUnit_NewJob";
            });

            $("#btnNewJob").button();
            $("#btnSearch").button();
            $("#btnClose").button();
            $("#btnDelete").button();
            $("#btnSave").button();


            $('#btnDelete').click(function () {
                var cmsg = confirm("Are you sure to delete " + document.getElementById("txtPU_ID1").value + "?");
                if (cmsg != 0) {
                    $.ajax({
                        url: "/PlanUnit/DeleteData_PlanUnit",
                        type: "POST",
                        dataType: "html",
                        data: {
                            "targetPlanUnit": document.getElementById("txtPU_ID1").value,
                            "targetBillRate": document.getElementById("txtPUBillRate").value,
                            "random": Math.random()
                        },
                        beforeSend: function () { },
                        success: function (data) {
                            var res = jQuery.parseJSON(data);

                            if (res.Success == true) {
                                alert("Deleted");
                                window.location.reload();
                            }
                            else {
                                alert("Delete failed.");
                            }
                        }
                    });
                }
            });


        });
    });

    function ShowIt() {
        document.getElementById("divLoading").style.visibility = "visible";
    }

    function HideIt() {
        document.getElementById("divLoading").style.visibility = "hidden";
    }
</script>
<br />
<h2>Plant Unit Management List</h2>
<div style="height:650px">
    <div>
        <table style="width:850px;">
            <tr>
                <td style="width:250px;">ID : <input type="text" id="searchKey" name="searchKey"  value="@ViewBag.searchKey"/></td>
                <td>Bill Rate : @Html.DropDownList("billRate", (IEnumerable<SelectListItem>)ViewBag.billrate, new { style = "width:150px" })</td>
                <td>UOM : @Html.DropDownList("searchUOM", (IEnumerable<SelectListItem>)ViewBag.UOM, new { style = "width:150px" })</td>
                <td><input type="button" value="Search" id="btnSearch" /></td>
                <td style="width:300px;"></td>
                <td style="text-align:right"><input type="button" value="Add New" id="btnNewJob" /></td>
            </tr>
        </table>
    </div><br />
     @if (Model.Count() > 0)
     {
       <table id="rounded-corner" summary="Plan Unit List" width="850px">
        <thead>
            <tr>                
                <th scope="col" style="width:50px">ID</th>
                <th scope="col" style="width:150px">DESCRIPTION</th>
                <th scope="col" style="width:50px">INSTALL PRICE</th>
                <th scope="col" style="width:50px">MAT PRICE</th>
                <th scope="col" style="width:50px">UOM</th>
                <th scope="col" style="width:50px">DURATION</th>
                <th scope="col" style="width:50px">NETWORK FLAG</th>
                <th scope="col" style="width:50px">ACT CODE</th>
                <th scope="col" style="width:50px">SUB DURATION</th>
                <th scope="col" style="width:50px">BILL RATE</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var res in Model)
        {
            <tr class="odd">               
                <td id="gid">@res.PU_ID</td>
                <td>@res.PU_DESC</td>
                <td>@res.PU_INST_PR</td>
                <td>@res.PU_MAT_PR</td>
                <td>@res.PU_UOM</td>
                <td>@res.PU_DURATION</td>
                <td>@res.PU_NETWORK_FLAG</td>
                <td>@res.PU_ACT_CODE</td>
                <td>@res.PU_SUP_DURATION</td>
                <td id="gcode">@res.PU_BILL_RATE</td>
                @*<td>@Ajax.ActionLink("View", "GetDetails_PlanUnit", new { id = res.PU_ID}, new AjaxOptions
               {
                   HttpMethod = "POST",
                   OnBegin = "ShowIt",
                   OnComplete = "HideIt",
                   UpdateTargetId = "divResultText",
                   OnSuccess = "GetDetailsCallBack"
               })</td>*@
            </tr>    
        }
        </tbody>
      </table>
         <div> Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)
            of @Model.PageCount
            &nbsp;
            @if (Model.HasPreviousPage)
            {
                @Html.ActionLink("<<", "PlanUnit_List", new { searchKey = ViewBag.searchKey, billRate = ViewBag.billrate2, searchUOM = ViewBag.UOM2, page = 1 })
                @Html.Raw("&nbsp;");
                @Html.ActionLink("< Prev", "PlanUnit_List", new { searchKey = ViewBag.searchKey, billRate = ViewBag.billrate2, searchUOM = ViewBag.UOM2, page = Model.PageNumber - 1 })
            }
            else
            {

            }
            &nbsp;
            @if (Model.HasNextPage)
            {
                @Html.ActionLink("Next >", "PlanUnit_List", new { searchKey = ViewBag.searchKey, billRate = ViewBag.billrate2, searchUOM = ViewBag.UOM2, page = Model.PageNumber + 1 })
                @Html.Raw("&nbsp;");
                @Html.ActionLink(">>", "PlanUnit_List", new { searchKey = ViewBag.searchKey, billRate = ViewBag.billrate2, searchUOM = ViewBag.UOM2, page = Model.PageCount })
            }
            else
            {

            }
            <br/><b> Total @Model.TotalItemCount records</b>
            </div>
     }
     else
     {
            @:<br /><span style="font-size:12px;">No record found.</span> 
     }
    <br />
    <div id="divLoading" style="visibility:hidden"><img src="@Url.Content("~/Content/images/rel_interstitial_loading.gif")" alt="loading..." /></div>
    <div id="divResultText"></div>
    <br />
    <div id="divDetails" title="Details" style="padding-left:40px; padding-top:30px;">
        
        <input type="hidden" id="targetPlanUnit" value="" />
        @using (Ajax.BeginForm("UpdateData_PlanUnit", new AjaxOptions()
        {
            OnBegin = "ShowIt",
            OnComplete = "HideIt",
            OnSuccess = "SaveUpdateCallBack"
        }))
        {
        <div id="list-details">
            <table width="600px">
                <tr>
                    <td style="width:100px; background-color:#e8eef4">ID</td>
                    <td><input type="text" id="txtPU_ID1" name="txtPU_ID1" readonly /></td>
                    <td style=" border-top-color:White; border-bottom-color:White"></td>
                    <td style="width:100px;background-color:#e8eef4">Description</td>
                    <td><input type="text" id="txtPU_DESC" name="txtPU_DESC" /></td>
                </tr>
                <tr>
                    <td style="width:100px; background-color:#e8eef4">Install Price</td>
                    <td><input type="text" id="txtPU_INST_PR" name="txtPU_INST_PR" /></td>
                    <td style=" border-top-color:White; border-bottom-color:White"></td>
                    <td style="width:100px;background-color:#e8eef4">MAT Price</td>
                    <td><input type="text" id="txtPU_MAT_PR" name="txtPU_MAT_PR" /></td>
                </tr>
                <tr>
                    <td style="width:100px; background-color:#e8eef4">UOM</td>
                    <td><select id="txtPU_UOM" name="txtPU_UOM">
                    </select> </td>
                    <td style=" border-top-color:White; border-bottom-color:White"></td>
                    <td style="width:100px;background-color:#e8eef4">DURATION</td>
                    <td><input type="text" id="txtDURATION" name="txtDURATION" /></td>
                </tr>
                <tr>
                    <td style="width:100px; background-color:#e8eef4">Network Flag</td>
                    <td><input type="text" id="txtNETWORK_FLAG" name="txtNETWORK_FLAG" /></td>
                    <td style=" border-top-color:White; border-bottom-color:White"></td>
                    <td style="width:100px;background-color:#e8eef4">ACT Code</td>
                    <td><input type="text" id="txtACT_CODE" name="txtACT_CODE" /></td>
                </tr>
                <tr>
                    <td style="width:100px; background-color:#e8eef4">SUB Duration</td>
                    <td><input type="text" id="txtSUP_DURATION" name="txtSUP_DURATION" /></td>
                    <td style=" border-top-color:White; border-bottom-color:White"></td>
                    <td style="width:100px;background-color:#e8eef4"></td>                   
                </tr>            
                <tr>
                    <td style="width:100px; background-color:#e8eef4">Bill Rate</td>
                    <td><input type="text" id="txtPUBillRate" name="txtPUBillRate" /></td>
                    <td style=" border-top-color:White; border-bottom-color:White"></td>
                    <td style="width:100px;background-color:#e8eef4"></td>                   
                </tr>     
                </table>
            <div style="height:30px; margin-top:10px; margin-left:10px;">
                <input type="button" value="Delete" id="btnDelete" style="height:30px;width:80px; vertical-align:top;" />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="submit" value="Save" id="btnSave" style="height:30px;width:80px; vertical-align:top;" />
                <input type="button" value="Cancel" id="btnClose" style="height:30px;width:80px;" />
            </div>
        </div>
        }
    </div>
</div>
    
